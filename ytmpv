#!/bin/sh

YT_DL="yt-dlp --add-metadata"
VIDP="mpv"
NTF="notify-send ytmpv"
MDIR="$HOME/Music"

SELITEM="$(dmenu -p "Video URL:" < /dev/null)"

[ "${SELITEM%%::*}" = "SADA" ] && SELITEM="XAUD::$(ytfzf -Il -D "${SELITEM#*::}" | head -n1)"

SELURL="${SELITEM#*::}"

case "${SELITEM:?}" in
	XAUD::*)
		$YT_DL "${SELURL:?}" -x --audio-format vorbis -P "$(find "$MDIR" -type d | dmenu -l 10 -p "Directory:" -z $MDIR)"\
			-o "$(dmenu -p "Filename:" -z Song < /dev/null)"\
      && $NTF "Download Completed" || $NTF "Failure To Download"
		;;
	DOWN::*) $YT_DL "${SELURL:?}" && $NTF "Download Completed" || $NTF "Failed to Download" ;; 

	*) $VIDP "$SELITEM" || $NTF "Failure to play URL" ;;
esac
